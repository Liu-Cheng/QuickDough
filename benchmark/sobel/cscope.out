cscope 15 $HOME/gitrepo/QuickDough/benchmark/sobel               0000016500
	@common.cpp

1 
	~"commÚ.h
"

3 
	gGL
::
idx
 = -1;

5 
	gGL
::
	$g‘Idx
(){

6 
idx
++;

7  
idx
;

8 
	}
}

10 
	g¡d
::
o¡»am
& 
İ”©Ü
<< (
¡d
::o¡»am &
os
, 
Opcode
 
	gİ
){

11 
	gİ
){

12 
	gMULSUB
:

13 
os
 << "MULSUB";

15 
	gMULADD
:

16 
os
 << "MULADD";

18 
	gMUL
:

19 
os
 << "MUL";

21 
	gADD
:

22 
os
 << "ADD";

24 
	gSUB
:

25 
os
 << "SUB";

27 
	gPHI
:

28 
os
 << "PHI";

30 
	gABS
:

31 
os
 << "ABS";

33 
	gGT
:

34 
os
 << "GT";

36 
	gLET
:

37 
os
 << "LET";

40 
HERE
;

41 
	g¡d
::
cout
 << "Undefšed Opcode. " << 
¡d
::
’dl
;

42 
ex™
(
EXIT_FAILURE
);

45  
	gos
;

48 
	g¡d
::
o¡»am
& 
İ”©Ü
<< (
¡d
::o¡»am &
os
, 
V”‹xTy³
 
	gvty³
){

49 
	gvty³
){

50 
	gIN
:

51 
os
 << "IM";

53 
	gOUT
:

54 
os
 << "OUT";

56 
	gIM
:

57 
os
 << "IM";

60 
HERE
;

61 
	g¡d
::
cout
 << "Undefšed v”‹xy³. " << 
¡d
::
’dl
;

62 
ex™
(
EXIT_FAILURE
);

65  
	gos
;

	@common.h

1 #iâdeà
__COMMON_H__


2 
	#__COMMON_H__


	)

4 
	~<io¡»am
>

5 
	~<s¡»am
>

6 
	~<c¡dlib
>

8 
	#MAX_IN_DEG
 3

	)

10 
	sGL
{

11 
	mpublic
:

12 
g‘Idx
();

14 
	m´iv©e
:

15 
idx
;

18 
	eOpcode
 {

19 
	mMULADD
,

20 
	mMULSUB
,

21 
	mMUL
,

22 
	mADD
,

23 
	mSUB
,

24 
	mPHI
,

25 
	mABS
,

26 
	mGT
,

27 
	mLET


30 
	eV”‹xTy³
 {

31 
	mIN
,

32 
	mIM
,

33 
	mOUT


36 
	g¡d
::
o¡»am
& 
İ”©Ü
<< (
¡d
::o¡»am &
os
, 
Opcode
 
	gİ
);

37 
	g¡d
::
o¡»am
& 
İ”©Ü
<< (
¡d
::o¡»am &
os
, 
V”‹xTy³
 
	gvty³
);

39 
	#HERE
 dØ{
¡d
::
cout
 <<"Fe: " << 
__FILE__
 << " Lše: " << 
__LINE__
 << std::
’dl
;} 0)

	)

	@dfg-gen.cpp

1 
	~"commÚ.h
"

2 
	~"v”‹x.h
"

3 
	~"sob–.h
"

4 
	~<c¡dlib
>

6 
	$maš
(){

8 
DFG
* 
dfg
 = 
Ãw
 
	`DFG
();

9 
dfg
->
	`k”ÃlToDFG
();

10 
dfg
->
	`compu‹
();

11 
dfg
->
	`v”ify
();

12 
dfg
->
	`dump
();

13 
dfg
->
	`dumpDÙ
("./dump/sobel.dot");

17 
	}
}

	@dump/io.h

1 #iâdeà
_IO_H_


2 
	#_IO_H_


	)

4 
	gaIn
[8][4];

5 
	gbIn
[4];

6 
	gcOut
[8];

	@sobel.cpp

1 
	~"sob–.h
"

3 
	gDFG
::
	$DFG
(){

4 
	`ioIn™
();

5 
¡d
::
cout
 << "DFG i š™Ÿlized." << std::
’dl
;

6 
	}
}

8 
	gDFG
::
	$ioIn™
(){

9 
i
 = 0; i < 
R
; i++){

10 
j
 = 0; j < 
C
; j++){

11 
figIn
[
i
][
j
] = 
	`¿nd
()%256;

12 
figOut
[
i
][
j
] = 0;

13 
gŞdOut
[
i
][
j
] = 0;

16 
	}
}

18 
V”‹x
* 
	gDFG
::
	$ü—‹V”‹x
(

19 
V”‹x
* 
v0
,

20 
V”‹x
* 
v1
,

21 
V”‹x
* 
v2
,

22 
Opcode
 
İ
,

23 
V”‹xTy³
 
ty³
)

25 
idx
 = 
GL
::
	`g‘Idx
();

26 
V”‹x
* 
v±r
 = 
Ãw
 
	`V”‹x
(
idx
, 
İ
, 
ty³
);

28 if(
v0
 !ğ
NULL
){

29 
v±r
->
šNgb
[0] = 
v0
->
idx
;

31 if(
v1
 !ğ
NULL
){

32 
v±r
->
šNgb
[1] = 
v1
->
idx
;

34 if(
v2
 !ğ
NULL
){

35 
v±r
->
šNgb
[2] = 
v2
->
idx
;

38  
v±r
;

39 
	}
}

41 
	gDFG
::
	$k”ÃlToDFG
(){

44 
i
 = 0; i < 
R
; i++){

45 
j
 = 0; j < 
C
; j++){

46 
idx
 = 
GL
::
	`g‘Idx
();

47 
Opcode
 
İ
 = 
MULADD
;

48 
V”‹xTy³
 
ty³
 = 
IN
;

49 
V”‹x
* 
v±r
 = 
Ãw
 
	`V”‹x
(
idx
, 
İ
, 
ty³
);

50 
v±r
->
v®
 = ()(
figIn
[
i
][
j
]);

51 
v”tiûs
.
	`push_back
(
v±r
);

52 if(
v±r
->
ty³
 !ğ
IN
 && v±r->
idx
 == 17){

53 
¡d
::
cout
 << "Wh©h© fuck." << std::
’dl
;

55 
figInIdx
 = 
i
 * 
C
 + 
j
;

56 
figInIdxToVidx
[
figInIdx
] = 
idx
;

61 
i
 = 0; i < 3; i++){

62 
j
 = 0; j < 3; j++){

63 
idx
 = 
GL
::
	`g‘Idx
();

64 
Opcode
 
İ
 = 
MULADD
;

65 
V”‹xTy³
 
ty³
 = 
IN
;

66 
V”‹x
* 
v±r
 = 
Ãw
 
	`V”‹x
(
idx
, 
İ
, 
ty³
);

67 
v±r
->
v®
 = 
gx
[
i
][
j
];

68 
v”tiûs
.
	`push_back
(
v±r
);

69 
gxIdx
 = 
i
 * 3 + 
j
;

70 
gxIdxToVidx
[
gxIdx
] = 
idx
;

75 
i
 = 0; i < 3; i++){

76 
j
 = 0; j < 3; j++){

77 
idx
 = 
GL
::
	`g‘Idx
();

78 
Opcode
 
İ
 = 
MULADD
;

79 
V”‹xTy³
 
ty³
 = 
IN
;

80 
V”‹x
* 
v±r
 = 
Ãw
 
	`V”‹x
(
idx
, 
İ
, 
ty³
);

81 
v±r
->
v®
 = 
gy
[
i
][
j
];

82 
v”tiûs
.
	`push_back
(
v±r
);

83 
gyIdx
 = 
i
 * 3 + 
j
;

84 
gyIdxToVidx
[
gyIdx
] = 
idx
;

89 autØ
c
 : 
cÚ¡s
){

90 
idx
 = 
GL
::
	`g‘Idx
();

91 
Opcode
 
İ
 = 
MULADD
;

92 
V”‹xTy³
 
ty³
 = 
IN
;

93 
V”‹x
* 
v±r
 = 
Ãw
 
	`V”‹x
(
idx
, 
İ
, 
ty³
);

94 
v±r
->
v®
 = 
c
;

95 
v”tiûs
.
	`push_back
(
v±r
);

96 
cÚ¡sToVidx
[
c
] = 
idx
;

99 
i
 = 0; i < 
R
; i++){

100 
j
 = 0; j < 
C
; j++){

101 if(
i
 =ğ0 || 
j
 =ğ0 || i =ğ
R
-1 || j =ğ
C
-1){

105 
V”‹x
* 
sumx
;

106 
V”‹x
* 
sumy
;

107 
p
 = -1;… <= 1;…++){

108 
q
 = -1; q <= 1; q++){

109 
V”‹x
* 
v0
 = 
v”tiûs
[
figInIdxToVidx
[(
i
+
p
)*
C
+(
j
+
q
)]];

110 
V”‹x
* 
v1
 = 
v”tiûs
[
gxIdxToVidx
[(
p
+1)*3+
q
+1]];

111 
V”‹x
* 
v2
 = 
v”tiûs
[
gyIdxToVidx
[(
p
+1)*3+
q
+1]];

112 if(
p
 =ğ-1 && 
q
== -1){

113 
sumx
 = 
	`ü—‹V”‹x
(
v0
, 
v1
, 
NULL
, 
MUL
, 
IM
);

114 
sumy
 = 
	`ü—‹V”‹x
(
v0
, 
v2
, 
NULL
, 
MUL
, 
IM
);

115 
v”tiûs
.
	`push_back
(
sumx
);

116 
v”tiûs
.
	`push_back
(
sumy
);

119 
V”‹x
* 
mulx
 = 
	`ü—‹V”‹x
(
v0
, 
v1
, 
NULL
, 
MUL
, 
IM
);

120 
V”‹x
* 
muly
 = 
	`ü—‹V”‹x
(
v0
, 
v2
, 
NULL
, 
MUL
, 
IM
);

121 
sumx
 = 
	`ü—‹V”‹x
(
mulx
, sumx, 
NULL
, 
ADD
, 
IM
);

122 
sumy
 = 
	`ü—‹V”‹x
(
muly
, sumy, 
NULL
, 
ADD
, 
IM
);

123 
v”tiûs
.
	`push_back
(
mulx
);

124 
v”tiûs
.
	`push_back
(
muly
);

125 
v”tiûs
.
	`push_back
(
sumx
);

126 
v”tiûs
.
	`push_back
(
sumy
);

130 
V”‹x
* 
absSumx
 = 
	`ü—‹V”‹x
(
sumx
, 
NULL
, NULL, 
ABS
, 
IM
);

131 
V”‹x
* 
absSumy
 = 
	`ü—‹V”‹x
(
sumy
, 
NULL
, NULL, 
ABS
, 
IM
);

132 
V”‹x
* 
sum
 = 
	`ü—‹V”‹x
(
absSumx
, 
absSumy
, 
NULL
, 
ADD
, 
IM
);

133 
V”‹x
* 
c255
 = 
v”tiûs
[
cÚ¡sToVidx
[255]];

134 
V”‹x
* 
c0
 = 
v”tiûs
[
cÚ¡sToVidx
[0]];

135 
V”‹x
* 
sum_com¶
 = 
	`ü—‹V”‹x
(
c255
, 
sum
, 
NULL
, 
SUB
, 
IM
);

136 
V”‹x
* 
ı
 = 
	`ü—‹V”‹x
(
sum
, 
c255
, 
NULL
, 
GT
, 
IM
);

137 
v”tiûs
.
	`push_back
(
absSumx
);

138 
v”tiûs
.
	`push_back
(
absSumy
);

139 
v”tiûs
.
	`push_back
(
sum
);

140 
v”tiûs
.
	`push_back
(
sum_com¶
);

141 
v”tiûs
.
	`push_back
(
ı
);

142 
V”‹x
* 
out
 = 
	`ü—‹V”‹x
(
ı
, 
c0
, 
sum_com¶
, 
PHI
, 
OUT
);

143 
v”tiûs
.
	`push_back
(
out
);

144 
figOutIdxToVidx
[
i
*
C
+
j
] = 
out
->
idx
;

148 
	}
}

150 
	gDFG
::
	$iodump
(){

152 
¡d
::
¡ršg
 
fName
 = "./dump/io.h";

153 
¡d
::
of¡»am
 
fhªdË
;

154 
fhªdË
.
	`İ’
(
fName
.
	`c_¡r
());

155 if(!
fhªdË
.
	`is_İ’
()){

156 
¡d
::
cout
 << 
fName
 << "İ’ƒ¼Ü!" << std::
’dl
;

157 
	`ex™
(
EXIT_FAILURE
);

160 
fhªdË
 << "#iâdeà_IO_H_" << 
¡d
::
’dl
;

161 
fhªdË
 << "#defš_IO_H_" << 
¡d
::
’dl
 << std::endl;

162 
fhªdË
 << "unsigÃd ch¬ figIn[" << 
R
 << "][" << 
C
 << "];" << 
¡d
::
’dl
;

163 
fhªdË
 << "šˆgx[3][3];" << 
¡d
::
’dl
;

164 
fhªdË
 << "šˆgy[3][3];" << 
¡d
::
’dl
;

165 
fhªdË
 << "unsigÃd ch¬ figOut[" << 
R
 << "][" << 
C
 << "];" << 
¡d
::
’dl
;

166 
fhªdË
 << 
¡d
::
’dl
 << "#endif" << std::endl;

167 
fhªdË
.
	`şo£
();

169 
	}
}

174 
	gDFG
::
	$compu‹
(){

176 autØ
™
 = 
v”tiûs
.
	`begš
(); iˆ!ğv”tiûs.
	`’d
(); it++){

177 if((*
™
)->
ty³
 !ğ
IN
){

178 
¡d
::
cout
 << "idx = " << (*
™
)->
idx
 << std::
’dl
;

179 (*
™
)->
	`compu‹
(
v”tiûs
);

183 
i
 = 0; i < 
R
; i++){

184 
j
 = 0; j < 
C
; j++){

185 if(
i
 =ğ0 || 
j
 =ğ0 || i =ğ
R
 - 1 || j =ğ
C
 - 1) ;

186 
idx
 = 
figOutIdxToVidx
[
i
 * 
C
 + 
j
];

187 
figOut
[
i
][
j
] = ()(
v”tiûs
[
idx
]->
v®
);

191 
	}
}

194 
	gDFG
::
	$v”ify
(){

196 
i
 = 0; i < 
R
; i++){

197 
j
 = 0; j < 
C
; j++){

198 if(
i
 =ğ0 || 
j
 =ğ0 || i =ğ
R
 -1 || j =ğ
C
 -1){

201 if(
gŞdOut
[
i
][
j
] !ğ
figOut
[i][j]){

202 
HERE
;

203 
¡d
::
cout
 << "DFG computiÚ i wrÚg!" << std::
’dl
;

204 
¡d
::
cout
 << "ex³ùedOut[" << 
i
 << "][" << 
j
 << "] = " << ()(
gŞdOut
[i][j]) << " ";

205 
¡d
::
cout
 << "compu‹dOut[" << 
i
 << "][" << 
j
 << "] = " << ()(
figOut
[i][j]) << " ";

206 
¡d
::
cout
 << std::
’dl
;

207 
	`ex™
(
EXIT_FAILURE
);

212 
¡d
::
cout
 << "DFG v”ifiÿtiÚ…as£d!" << std::
’dl
;

214 
	}
}

216 
	gDFG
::
	$dump
(){

219 
¡d
::
o¡ršg¡»am
 
oss
;

220 
¡d
::
of¡»am
 
fhªdË
;

221 
oss
 << "./dump/dfg.s";

222 
fhªdË
.
	`İ’
(
oss
.
	`¡r
().
	`c_¡r
());

223 if(!
fhªdË
.
	`is_İ’
()){

224 
¡d
::
cout
 << "FaedØİ’" << 
oss
.
	`¡r
() << "\n";

225 
	`ex™
(
EXIT_FAILURE
);

228 
¡d
::
m­
<
Opcode
, > 
İSt
;

229 autØ
™
 = 
v”tiûs
.
	`begš
(); iˆ!ğv”tiûs.
	`’d
(); it++){

230 if((*
™
)->
ty³
 !ğ
IN
){

231 
fhªdË
 << (*
™
)->
idx
 << " ";

232 
fhªdË
 << (*
™
)->
İ
 << " ";

233 
fhªdË
 << (*
™
)->
ty³
 << " ";

234 if((*
™
)->
šNgb
[0] != -1){

235 
fhªdË
 << (*
™
)->
šNgb
[0] << " ";

238 if((*
™
)->
šNgb
[1] != -1){

239 
fhªdË
 << (*
™
)->
šNgb
[1] << " ";

242 if((*
™
)->
šNgb
[2] != -1){

243 
fhªdË
 << (*
™
)->
šNgb
[2] << " ";

245 
fhªdË
 << 
¡d
::
’dl
;

247 
Opcode
 
İ
 = (*
™
)->op;

248 if(
İSt
.
	`fšd
(
İ
è=ğİSt.
	`’d
()){

249 
İSt
[
İ
] = 1;

252 
İSt
[
İ
] += 1;

256 
fhªdË
.
	`şo£
();

259 
oss
.
	`ş—r
();

260 
oss
.
	`¡r
("");

261 
oss
 << "./dump/opcode.txt";

262 
fhªdË
.
	`İ’
(
oss
.
	`¡r
().
	`c_¡r
());

263 if(!
fhªdË
.
	`is_İ’
()){

264 
¡d
::
cout
 << "FaedØİ’" << 
oss
.
	`¡r
() << "\n";

265 
	`ex™
(
EXIT_FAILURE
);

268 autØ
™
 = 
İSt
.
	`begš
(); iˆ!ğİSt.
	`’d
(); it++){

269 
fhªdË
 << 
™
->
fœ¡
 << 
¡d
::
’dl
;;

271 
fhªdË
.
	`şo£
();

274 
oss
.
	`ş—r
();

275 
oss
.
	`¡r
("");

276 
oss
 << "./dump/Stat.txt";

277 
fhªdË
.
	`İ’
(
oss
.
	`¡r
().
	`c_¡r
());

278 if(!
fhªdË
.
	`is_İ’
()){

279 
¡d
::
cout
 << "FaedØİ’" <<
oss
.
	`¡r
() << "\n";

280 
	`ex™
(
EXIT_FAILURE
);

283 
fhªdË
 << "DFG Sti¡ic:" << 
¡d
::
’dl
;

284 
fhªdË
 << "v”‹xNum: " << 
v”tiûs
.
	`size
(è<< 
¡d
::
’dl
;

285 
fhªdË
 << "šNum " << 
	`g‘InNum
(è<< 
¡d
::
’dl
;

286 
fhªdË
 << "outNum " << 
	`g‘OutNum
(è<< 
¡d
::
’dl
;

287 
fhªdË
 << "imNum " << 
	`g‘ImNum
(è<< 
¡d
::
’dl
;

288 
fhªdË
 << "avgDeg»" << 
	`g‘AvgDeg»e
(è<< 
¡d
::
’dl
;

289 
fhªdË
.
	`şo£
();

292 
	`iodump
();

294 
	}
}

296 
	gDFG
::
	$g‘InNum
(){

297 
num
 = 0;

298 autØ
™
 = 
v”tiûs
.
	`begš
(); iˆ!ğv”tiûs.
	`’d
(); it++){

299 if((*
™
)->
ty³
 =ğ
IN
){

300 
num
++;

303  
num
;

304 
	}
}

306 
	gDFG
::
	$g‘OutNum
(){

307 
num
 = 0;

308 autØ
™
 = 
v”tiûs
.
	`begš
(); iˆ!ğv”tiûs.
	`’d
(); it++){

309 if((*
™
)->
ty³
 =ğ
OUT
){

310 
num
++;

313  
num
;

314 
	}
}

316 
	gDFG
::
	$g‘ImNum
(){

317 
num
 = 0;

318 autØ
™
 = 
v”tiûs
.
	`begš
(); iˆ!ğv”tiûs.
	`’d
(); it++){

319 if((*
™
)->
ty³
 =ğ
IM
){

320 
num
++;

323  
num
;

324 
	}
}

326 
	gDFG
::
	$g‘AvgDeg»e
(){

327 
sum
 = 0;

328 autØ
™
 = 
v”tiûs
.
	`begš
(); iˆ!ğv”tiûs.
	`’d
(); it++){

329 if((*
™
)->
šNgb
[0] != -1){

330 
sum
++;

333 if((*
™
)->
šNgb
[1] != -1){

334 
sum
++;

337 if((*
™
)->
šNgb
[2] != -1){

338 
sum
++;

342 
avgDeg»e
 = 1.0 * 
sum
/(
	`g‘ImNum
(è+ 
	`g‘OutNum
());

344  
avgDeg»e
;

345 
	}
}

348 
	gDFG
::
	$dumpDÙ
(cÚ¡ 
¡d
::
¡ršg
& 
âame
){

350 
¡d
::
m­
<, std::
¡ršg
> 
idToLab–
;

351 
	`ü—‹Lab–M­
(
idToLab–
);

353 
¡d
::
of¡»am
 
	`fhªdË
(
âame
.
	`c_¡r
());

354 if(!
fhªdË
.
	`is_İ’
()){

355 
HERE
;

356 
¡d
::
cout
 << "FaedØİ’ " << 
âame
.
	`c_¡r
(è<< "." << std::
’dl
;

357 
	`ex™
(
EXIT_FAILURE
);

361 
fhªdË
 << "dig¿ph G {" << 
¡d
::
’dl
;

362 autØ
™
 = 
v”tiûs
.
	`begš
(); iˆ!ğv”tiûs.
	`’d
(); it++){

363 
fhªdË
 << (*
™
)->
idx
 << "[Ïb–=\"" << 
idToLab–
[(*™)->idx] << "\"];" << 
¡d
::
’dl
;

365 autØ
™
 = 
v”tiûs
.
	`begš
(); iˆ!ğv”tiûs.
	`’d
(); it++){

366 if((*
™
)->
šNgb
[0] != -1){

367 
fhªdË
 << (*
™
)->
šNgb
[0] << " -> ";

368 
fhªdË
 << (*
™
)->
idx
 << ";" << 
¡d
::
’dl
;

371 if((*
™
)->
šNgb
[1] != -1){

372 
fhªdË
 << (*
™
)->
šNgb
[1] << " -> ";

373 
fhªdË
 << (*
™
)->
idx
 << ";" << 
¡d
::
’dl
;

376 if((*
™
)->
šNgb
[2] != -1){

377 
fhªdË
 << (*
™
)->
šNgb
[2] << " -> ";

378 
fhªdË
 << (*
™
)->
idx
 << ";" << 
¡d
::
’dl
;

382 
fhªdË
 << "}" << 
¡d
::
’dl
;

384 
fhªdË
.
	`şo£
();

386 
	}
}

388 
	gDFG
::
ü—‹Lab–M­
(
¡d
::
m­
<, std::
¡ršg
> &
idToLab–
){

389 
i
 = 0; 
	gi
 < 
	gR
; i++){

390 
	gj
 = 0; j < 
	gC
; j++){

391 
	g¡d
::
o¡ršg¡»am
 
oss
;

392 
	goss
 << "figIn[" << 
	gi
 << "][" << 
	gj
 << "]";

393 
	gfigInIdx
 = 
i
 * 
C
 + 
j
;

394 
	gvidx
 = 
figInIdxToVidx
[
figInIdx
];

395 
	gidToLab–
[
vidx
] = 
oss
.
¡r
();

399 
	gi
 = 0; i < 3; i++){

400 
	gj
 = 0; j < 3; j++){

401 
	g¡d
::
o¡ršg¡»am
 
oss
;

402 
	goss
 << "gx[" << 
	gi
 << "][" << 
	gj
 << "]";

403 
	ggxIdx
 = 
i
 * 3 + 
j
;

404 
	gvidx
 = 
gxIdxToVidx
[
gxIdx
];

405 
	gidToLab–
[
vidx
] = 
oss
.
¡r
();

409 
	gi
 = 0; i < 3; i++){

410 
	gj
 = 0; j < 3; j++){

411 
	g¡d
::
o¡ršg¡»am
 
oss
;

412 
	goss
 << "gy[" << 
	gi
 << "][" << 
	gj
 <<"]";

413 
	ggyIdx
 = 
i
 * 3 + 
j
;

414 
	gvidx
 = 
gyIdxToVidx
[
gyIdx
];

415 
	gidToLab–
[
vidx
] = 
oss
.
¡r
();

419 
	gi
 = 0; i < 
	gR
; i++){

420 
	gj
 = 0; j < 
	gC
; j++){

421 
	g¡d
::
o¡ršg¡»am
 
oss
;

422 
	goss
 << "figOut[" << 
	gi
 << "][" << 
	gj
 << "]";

423 
	gfigOutIdx
 = 
i
 * 
C
 + 
j
;

424 
	gvidx
 = 
figOutIdxToVidx
[
figOutIdx
];

425 
	gidToLab–
[
vidx
] = 
oss
.
¡r
();

429 autØ
	g™
 = 
v”tiûs
.
begš
(); it!ğv”tiûs.
’d
(); it++){

430 if((*
	g™
)->
	gty³
 =ğ
IM
){

431 
¡d
::
o¡ršg¡»am
 
oss
;

432 
	goss
 << (*
	g™
)->
	gİ
;

433 
	gidToLab–
[(*
™
)->
idx
] = 
oss
.
¡r
();

438 
	gDFG
::
	$¡ªd¬dSob–
(){

440 
i
 = 0; i < 
R
; i++){

441 
j
 = 0; j < 
C
; j++){

442 
sumx
 = 0;

443 
sumy
 = 0;

446 if(
i
 =ğ0 || 
j
 =ğ0 || i =ğ
R
-1 || j =ğ
C
-1){

450 
p
 = -1;… <= 1;…++){

451 
q
 = -1; q <= 1; q++){

452 
sumx
 +ğ()
figIn
[
i
+
p
][
j
+
q
] * 
gx
[p+1][q+1];

453 
sumy
 +ğ()
figIn
[
i
+
p
][
j
+
q
] * 
gy
[p+1][q+1];

457 
sum
=
	`abs
(
sumx
è+‡bs(
sumy
);

459 if(
sum
 > 255){

460 
gŞdOut
[
i
][
j
] = 0;

463 
gŞdOut
[
i
][
j
] = ()(255-
sum
);

468 
	}
}

	@sobel.h

1 #iâdeà
__SOBEL_H__


2 
	#__SOBEL_H__


	)

4 
	~"v”‹x.h
"

5 
	~"commÚ.h
"

6 
	~<f¡»am
>

7 
	~<m­
>

8 
	~<c¡dlib
>

10 
	#R
 8

	)

11 
	#C
 16

	)

13 şas 
	cDFG
{

14 
	mpublic
:

15 
¡d
::
veùÜ
<
V”‹x
*> 
v”tiûs
;

19 
	m¡d
::
m­
<, > 
	mfigInIdxToVidx
;

20 
	m¡d
::
m­
<, > 
	mfigOutIdxToVidx
;

21 
	m¡d
::
m­
<, > 
	mgxIdxToVidx
;

22 
	m¡d
::
m­
<, > 
	mgyIdxToVidx
;

23 
	m¡d
::
m­
<, > 
	mcÚ¡sToVidx
;

25 
dump
();

26 
dumpDÙ
(cÚ¡ 
¡d
::
¡ršg
 &
âame
);

27 
v”ify
();

28 
compu‹
();

29 
k”ÃlToDFG
();

30 
¡ªd¬dSob–
();

32 
DFG
();

34 
	m´iv©e
:

35 
figIn
[
R
][
C
];

36 
	mgx
[3][3] = {{1, 0 , -1}, {2, 0, -2}, {1, 0, -1}};

37 
	ggy
[3][3] = {{1, 2, 1}, {0, 0, 0}, {-1, -2, -1}};

38 
	gcÚ¡s
[2] = {0, 255};

39 
	gfigOut
[
R
][
C
];

40 
	ggŞdOut
[
R
][
C
];

42 
V”‹x
* 
ü—‹V”‹x
(

43 
V”‹x
* 
v0
,

44 
V”‹x
* 
v1
,

45 
V”‹x
* 
v2
,

46 
Opcode
 
İ
,

47 
V”‹xTy³
 
ty³


50 
g‘AvgDeg»e
();

51 
g‘InNum
();

52 
g‘ImNum
();

53 
g‘OutNum
();

54 
iodump
();

55 
ioIn™
();

56 
ü—‹Lab–M­
(
¡d
::
m­
<, std::
¡ršg
> &
idToLab–
);

	@vertex.cpp

1 
	~"v”‹x.h
"

3 
	gV”‹x
::
	$V”‹x
(
_idx
, 
Opcode
 
_İ
, 
V”‹xTy³
 
_ty³
){

5 
v®id
 = 
Œue
;

6 
idx
 = 
_idx
;

7 
ty³
 = 
_ty³
;

8 
İ
 = 
_İ
;

10 
i
 = 0; i < 
MAX_IN_DEG
; i++){

11 
šNgb
[
i
] = -1;

14 
	}
}

16 
	gV”‹x
::
	$V”‹x
(
boŞ
 
_v®id
){

17 
v®id
 = 
_v®id
;

18 
idx
 = 0;

19 
ty³
 = 
IN
;

20 
İ
 = 
MULADD
;

22 
i
 = 0; i < 
MAX_IN_DEG
; i++){

23 
šNgb
[
i
] = -1;

25 
	}
}

27 
	gV”‹x
::
compu‹
(cÚ¡ 
¡d
::
veùÜ
<
V”‹x
*> &
v”tiûs
){

28 
İ
){

29 
MULADD
:

30 
v®
 = 
v”tiûs
[
šNgb
[0]]->val * vertices[inNgb[1]]->val + vertices[inNgb[2]]->val;

33 
	gMULSUB
:

34 
v®
 = 
v”tiûs
[
šNgb
[0]]->val * vertices[inNgb[1]]->val - vertices[inNgb[2]]->val;

37 
	gADD
:

38 
v®
 = 
v”tiûs
[
šNgb
[0]]->val + vertices[inNgb[1]]->val;

41 
	gSUB
:

42 
v®
 = 
v”tiûs
[
šNgb
[0]]->val - vertices[inNgb[1]]->val;

45 
	gPHI
:

46 
v®
 = (
v”tiûs
[
šNgb
[0]]->val != 0)? vertices[inNgb[1]]->val : vertices[inNgb[2]]->val;

49 
	gMUL
:

50 
v®
 = 
v”tiûs
[
šNgb
[0]]->val * vertices[inNgb[1]]->val;

53 
	gABS
:

54 
v®
 = 
abs
(
v”tiûs
[
šNgb
[0]]->val);

57 
	gGT
:

58 
v®
 = (
v”tiûs
[
šNgb
[0]]->val > vertices[inNgb[1]]->val) ? 1 : 0;

61 
	gLET
:

62 
v®
 = (
v”tiûs
[
šNgb
[0]]->val <= vertices[inNgb[1]]->val) ? 1 : 0;

66 
HERE
;

67 
	g¡d
::
cout
 << " Opcodi nÙ„ecognized." << 
¡d
::
’dl
;

68 
ex™
(
EXIT_FAILURE
);

	@vertex.h

1 #iâdeà
__VERTEX_H__


2 
	#__VERTEX_H__


	)

4 
	~"commÚ.h
"

5 
	~<veùÜ
>

7 
	sV”‹x
{

9 
	mpublic
:

10 
boŞ
 
v®id
;

11 
	midx
;

12 
Opcode
 
	mİ
;

13 
	mv®
;

14 
V”‹xTy³
 
	mty³
;

15 
	mšNgb
[
MAX_IN_DEG
];

16 
compu‹
(cÚ¡ 
¡d
::
veùÜ
<
V”‹x
*> &
v”tiûs
);

18 
V”‹x
(
_idx
, 
Opcode
 
_İ
, 
V”‹xTy³
 
_ty³
);

19 
V”‹x
(
boŞ
 
_v®id
);

	@
1
.
1
/usr/include
8
80
common.cpp
common.h
dfg-gen.cpp
dump/io.h
sobel.cpp
sobel.h
vertex.cpp
vertex.h
